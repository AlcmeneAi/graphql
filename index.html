<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Profile</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>

    <!-- Background -->
    <div id="background-container"></div>

    <!-- Master UI wrapper -->
    <div id="uiWrapper">
        <!-- Sign -->
        <h1 class="graphql-title">GraphQL</h1>

        <!-- Login form -->
        <div id="loginFormContainer">
            <form id="loginForm">
                <input type="text" id="username" class="custom-input" placeholder="Username or Email" required>
                <input type="password" id="password" class="custom-input" placeholder="Password" required>
                <button type="submit" class="custom-button"></button>
            </form>
            <p id="errorMsg" style="color: red;"></p>
        </div>
    </div>

    <script>
        // GitHub Pages version - Direct GraphQL API
        const GRAPHQL_ENDPOINT = "https://learn.reboot01.com/api/graphql-engine/v1/graphql";

        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const errorMsg = document.getElementById("errorMsg");

            try {
                const credentials = btoa(`${username}:${password}`);
                const testQuery = `{ user { id login } }`;

                const response = await fetch(GRAPHQL_ENDPOINT, {
                    method: "POST",
                    headers: { 
                        "Content-Type": "application/json",
                        "Authorization": `Basic ${credentials}`
                    },
                    body: JSON.stringify({ query: testQuery }),
                });

                const data = await response.json();

                if (data.errors) {
                    errorMsg.textContent = "Invalid credentials. Please try again.";
                    return;
                }

                localStorage.setItem("jwt", credentials);
                window.location.href = "templates/profile.html";
            } catch (err) {
                errorMsg.textContent = "Login failed. Please check your credentials.";
                console.error(err);
            }
        });
    </script>
</body>
</html>
